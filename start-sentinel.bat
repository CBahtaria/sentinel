@echo off
title UEDF SENTINEL v5.0 - COMMAND LAUNCH PANEL
color 0A
mode con: cols=80 lines=35

:: ============================================
:: UEDF SENTINEL v5.0 - System Startup Script
:: UMBUTFO ESWATINI DEFENCE FORCE
:: Last Updated: 2026-02-17
:: ============================================

:main
cls
echo.
echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo ‚ïë                                                              ‚ïë
echo ‚ïë     ‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó                       ‚ïë
echo ‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù                       ‚ïë
echo ‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó                         ‚ïë
echo ‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù                         ‚ïë
echo ‚ïë     ‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë                            ‚ïë
echo ‚ïë      ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù                            ‚ïë
echo ‚ïë                                                              ‚ïë
echo ‚ïë                 S E N T I N E L   v 5 . 0                   ‚ïë
echo ‚ïë                                                              ‚ïë
echo ‚ïë         UMBUTFO ESWATINI DEFENCE FORCE                       ‚ïë
echo ‚ïë              CLASSIFIED - TOP SECRET                        ‚ïë
echo ‚ïë                                                              ‚ïë
echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
echo                             ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo                             ‚ïë  MAIN MENU    ‚ïë
echo                             ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
echo    [1] üöÄ START ALL SERVICES (Full System)
echo    [2] üîå START WebSocket Server Only
echo    [3] üåê OPEN in Browser
echo    [4] üìä CHECK System Status
echo    [5] üõë STOP All Services
echo    [6] üîÑ RESTART All Services
echo    [7] üìã VIEW Logs
echo    [8] ‚öôÔ∏è  ADVANCED Options
echo    [9] üîç DIAGNOSTICS Mode
echo    [0] ‚ùå EXIT
echo.
echo ================================================================
set /p choice="‚ï∞‚îÄ‚û§ Select option (0-9): "

if "%choice%"=="1" goto start_all
if "%choice%"=="2" goto start_websocket
if "%choice%"=="3" goto open_browser
if "%choice%"=="4" goto check_status
if "%choice%"=="5" goto stop_all
if "%choice%"=="6" goto restart_all
if "%choice%"=="7" goto view_logs
if "%choice%"=="8" goto advanced_menu
if "%choice%"=="9" goto diagnostics
if "%choice%"=="0" goto exit
echo Invalid choice & timeout /t 2 >nul & goto main

:: ============================================
:: START ALL SERVICES
:: ============================================
:start_all
cls
echo.
echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo ‚ïë           STARTING ALL UEDF SENTINEL SERVICES                ‚ïë
echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.

:: Check and start Apache
echo [1/6] üîç Checking Apache service...
sc query apache2.4 | find "RUNNING" > nul
if errorlevel 1 (
    echo      ‚ö†Ô∏è  Apache is not running. Starting...
    net start apache2.4 > nul 2>&1
    if errorlevel 1 (
        echo      ‚ùå Failed to start Apache!
        set apache_status=FAILED
    ) else (
        echo      ‚úÖ Apache started successfully
        set apache_status=OK
    )
) else (
    echo      ‚úÖ Apache is already running
    set apache_status=OK
)

:: Check and start MySQL
echo [2/6] üîç Checking MySQL service...
sc query mysql | find "RUNNING" > nul
if errorlevel 1 (
    echo      ‚ö†Ô∏è  MySQL is not running. Starting...
    net start mysql > nul 2>&1
    if errorlevel 1 (
        echo      ‚ùå Failed to start MySQL!
        set mysql_status=FAILED
    ) else (
        echo      ‚úÖ MySQL started successfully
        set mysql_status=OK
    )
) else (
    echo      ‚úÖ MySQL is already running
    set mysql_status=OK
)

:: Start WebSocket Server
echo [3/6] üîå Starting WebSocket Server...
tasklist /fi "imagename eq php.exe" | find "websocket-server.php" > nul
if errorlevel 1 (
    start "UEDF WebSocket" /min cmd /c php websocket-server.php
    timeout /t 3 >nul
    tasklist /fi "imagename eq php.exe" | find "websocket-server.php" > nul
    if errorlevel 1 (
        echo      ‚ùå Failed to start WebSocket server
        set ws_status=FAILED
    ) else (
        echo      ‚úÖ WebSocket server started on port 8081
        set ws_status=OK
    )
) else (
    echo      ‚úÖ WebSocket server already running
    set ws_status=OK
)

:: Check Database Connection
echo [4/6] üíæ Testing database connection...
php -r "try{new PDO('mysql:host=localhost;dbname=uedf_sentinel','root','');echo 'OK';}catch(Exception \$e){echo 'FAILED';}" > db_test.tmp
set /p db_status=<db_test.tmp
del db_test.tmp
if "%db_status%"=="OK" (
    echo      ‚úÖ Database connection successful
    set db_status=OK
) else (
    echo      ‚ùå Database connection failed
    set db_status=FAILED
)

:: Check required directories
echo [5/6] üìÅ Checking system directories...
if not exist "logs" mkdir logs
if not exist "cache" mkdir cache
if not exist "backups" mkdir backups
if not exist "uploads" mkdir uploads
echo      ‚úÖ Directory structure verified

:: Final status
echo [6/6] üìä Compiling system status...
echo.
echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo ‚ïë                    SYSTEM STATUS REPORT                      ‚ïë
echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
echo    Apache Web Server      : %apache_status%
echo    MySQL Database         : %mysql_status%
echo    WebSocket Server       : %ws_status%
echo    Database Connection    : %db_status%
echo.
echo ================================================================

:: Open browser if all critical services are OK
if "%apache_status%"=="OK" (
    echo [üåê] Opening browser to login page...
    timeout /t 2 >nul
    start http://localhost:8080/sentinel/
) else (
    echo [‚ö†Ô∏è] Apache not running - cannot open browser
)

echo.
echo Press any key to return to main menu...
pause >nul
goto main

:: ============================================
:: START WEBSOCKET ONLY
:: ============================================
:start_websocket
cls
echo.
echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo ‚ïë                STARTING WEBSOCKET SERVER                     ‚ïë
echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.

:: Kill existing WebSocket processes
taskkill /f /fi "windowtitle eq UEDF WebSocket" > nul 2>&1

:: Start new WebSocket server
echo Starting WebSocket server on port 8081...
start "UEDF WebSocket" /min cmd /c php websocket-server.php
timeout /t 3 >nul

:: Verify it's running
tasklist /fi "imagename eq php.exe" | find "websocket-server.php" > nul
if errorlevel 1 (
    echo ‚ùå Failed to start WebSocket server
    echo.
    echo Possible issues:
    echo - Port 8081 is already in use
    echo - PHP is not in PATH
    echo - websocket-server.php is missing
) else (
    echo ‚úÖ WebSocket server is running
    echo.
    echo WebSocket URL: ws://localhost:8081
)

echo.
echo Press any key to return to main menu...
pause >nul
goto main

:: ============================================
:: OPEN BROWSER
:: ============================================
:open_browser
cls
echo.
echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo ‚ïë                    OPENING BROWSER                           ‚ïë
echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.

:: Try different browsers in order of preference
echo Opening UEDF Sentinel in your default browser...
start http://localhost:8080/sentinel/

:: Also open health check in new tab (optional)
timeout /t 2 >nul
start http://localhost:8080/sentinel/health.php

echo ‚úÖ Browser launched
echo.
echo If browser doesn't open, manually navigate to:
echo http://localhost:8080/sentinel/
echo.
pause
goto main

:: ============================================
:: CHECK SYSTEM STATUS
:: ============================================
:check_status
cls
echo.
echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo ‚ïë                  SYSTEM STATUS CHECK                         ‚ïë
echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.

:: Get current date/time
echo Timestamp: %date% %time%
echo.

:: Check Apache
sc query apache2.4 | find "RUNNING" > nul
if errorlevel 1 (
    echo [‚ö†Ô∏è]  Apache Web Server    : STOPPED
) else (
    echo [‚úÖ] Apache Web Server    : RUNNING
)

:: Check MySQL
sc query mysql | find "RUNNING" > nul
if errorlevel 1 (
    echo [‚ö†Ô∏è]  MySQL Database       : STOPPED
) else (
    echo [‚úÖ] MySQL Database       : RUNNING
)

:: Check WebSocket
tasklist /fi "imagename eq php.exe" | find "websocket-server.php" > nul
if errorlevel 1 (
    echo [‚ö†Ô∏è]  WebSocket Server    : STOPPED
) else (
    echo [‚úÖ] WebSocket Server    : RUNNING
)

:: Check PHP
php -v > nul 2>&1
if errorlevel 1 (
    echo [‚ùå] PHP                  : NOT FOUND IN PATH
) else (
    for /f "tokens=2 delims= " %%a in ('php -v ^| find "PHP"') do (
        echo [‚úÖ] PHP                  : %%a
        goto :php_done
    )
    :php_done
)

:: Check disk space
for /f "tokens=3" %%a in ('dir C:\ ^| find "free"') do set freespace=%%a
echo [üíæ] Free Disk Space       : %freespace%

:: Check memory
wmic OS get FreePhysicalMemory /Value | find "=" > mem.tmp
for /f "tokens=2 delims==" %%a in (mem.tmp) do set freemem=%%a
del mem.tmp
set /a freemem=%freemem% / 1024
echo [üß†] Free Memory           : %freemem% MB

:: Check critical files
echo.
echo Critical Files:
if exist "index.php" (echo    [‚úÖ] index.php) else (echo    [‚ùå] index.php)
if exist "login.php" (echo    [‚úÖ] login.php) else (echo    [‚ùå] login.php)
if exist "home.php" (echo    [‚úÖ] home.php) else (echo    [‚ùå] home.php)
if exist "websocket-server.php" (echo    [‚úÖ] websocket-server.php) else (echo    [‚ùå] websocket-server.php)

:: Check logs
echo.
echo Recent Log Entries:
if exist "logs\php_errors.log" (
    tail -n 5 logs\php_errors.log 2>nul || echo    (Cannot display logs - install tail command)
) else (
    echo    No error logs found
)

echo.
echo ================================================================
echo Run health check in browser for detailed status
echo.
pause
goto main

:: ============================================
:: STOP ALL SERVICES
:: ============================================
:stop_all
cls
echo.
echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo ‚ïë                   STOPPING ALL SERVICES                      ‚ïë
echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.

:: Stop WebSocket
echo Stopping WebSocket server...
taskkill /f /fi "windowtitle eq UEDF WebSocket" > nul 2>&1
taskkill /f /im php.exe > nul 2>&1
echo ‚úÖ WebSocket stopped

:: Stop Apache (optional - comment out if you don't want to stop Apache)
echo.
echo Stop Apache? (y/n)
set /p stop_apache=
if /i "%stop_apache%"=="y" (
    net stop apache2.4
    echo ‚úÖ Apache stopped
)

:: Stop MySQL (optional)
echo.
echo Stop MySQL? (y/n)
set /p stop_mysql=
if /i "%stop_mysql%"=="y" (
    net stop mysql
    echo ‚úÖ MySQL stopped
)

echo.
echo All requested services stopped
pause
goto main

:: ============================================
:: RESTART ALL SERVICES
:: ============================================
:restart_all
cls
echo.
echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo ‚ïë                  RESTARTING ALL SERVICES                     ‚ïë
echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.

:: Stop services
echo Stopping services...
taskkill /f /fi "windowtitle eq UEDF WebSocket" > nul 2>&1
taskkill /f /im php.exe > nul 2>&1
net stop apache2.4 > nul 2>&1
net stop mysql > nul 2>&1
timeout /t 3 >nul

:: Start services
echo Starting services...
net start apache2.4 > nul 2>&1
net start mysql > nul 2>&1
start "UEDF WebSocket" /min cmd /c php websocket-server.php
timeout /t 5 >nul

echo ‚úÖ All services restarted
echo.
pause
goto main

:: ============================================
:: VIEW LOGS
:: ============================================
:view_logs
cls
echo.
echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo ‚ïë                      LOG VIEWER                              ‚ïë
echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
echo [1] View PHP Error Log
echo [2] View Apache Access Log
echo [3] View Apache Error Log
echo [4] View MySQL Error Log
echo [5] View WebSocket Log
echo [6] Clear All Logs
echo [7] Back to Main Menu
echo.

set /p log_choice="Select log to view (1-7): "

if "%log_choice%"=="1" (
    if exist "logs\php_errors.log" (
        notepad logs\php_errors.log
    ) else (
        echo No PHP error log found
        pause
    )
    goto view_logs
)
if "%log_choice%"=="2" (
    if exist "C:\xampp\apache\logs\access.log" (
        notepad "C:\xampp\apache\logs\access.log"
    ) else (
        echo No Apache access log found
        pause
    )
    goto view_logs
)
if "%log_choice%"=="3" (
    if exist "C:\xampp\apache\logs\error.log" (
        notepad "C:\xampp\apache\logs\error.log"
    ) else (
        echo No Apache error log found
        pause
    )
    goto view_logs
)
if "%log_choice%"=="4" (
    if exist "C:\xampp\mysql\data\mysql.err" (
        notepad "C:\xampp\mysql\data\mysql.err"
    ) else (
        echo No MySQL error log found
        pause
    )
    goto view_logs
)
if "%log_choice%"=="5" (
    if exist "logs\websocket.log" (
        notepad logs\websocket.log
    ) else (
        echo No WebSocket log found
        pause
    )
    goto view_logs
)
if "%log_choice%"=="6" (
    del /q logs\*.log 2>nul
    echo Logs cleared
    pause
    goto view_logs
)
if "%log_choice%"=="7" goto main
goto view_logs

:: ============================================
:: ADVANCED MENU
:: ============================================
:advanced_menu
cls
echo.
echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo ‚ïë                    ADVANCED OPTIONS                          ‚ïë
echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
echo [1] Backup Database
echo [2] Restore Database
echo [3] Clear Cache
echo [4] Run Database Migrations
echo [5] Generate SSL Certificate
echo [6] Test Email Configuration
echo [7] Performance Test
echo [8] Return to Main Menu
echo.

set /p adv_choice="Select option (1-8): "

if "%adv_choice%"=="1" goto backup_db
if "%adv_choice%"=="2" goto restore_db
if "%adv_choice%"=="3" goto clear_cache
if "%adv_choice%"=="4" goto run_migrations
if "%adv_choice%"=="5" goto generate_ssl
if "%adv_choice%"=="6" goto test_email
if "%adv_choice%"=="7" goto performance_test
if "%adv_choice%"=="8" goto main
goto advanced_menu

:backup_db
cls
echo Backing up database...
set BACKUP_FILE=backups\sentinel_backup_%date:~-4,4%%date:~-10,2%%date:~-7,2%_%time:~0,2%%time:~3,2%%time:~6,2%.sql
set BACKUP_FILE=%BACKUP_FILE: =0%
mysqldump -u root uedf_sentinel > "%BACKUP_FILE%"
if exist "%BACKUP_FILE%" (
    echo ‚úÖ Database backed up to %BACKUP_FILE%
) else (
    echo ‚ùå Backup failed
)
pause
goto advanced_menu

:restore_db
cls
echo Available backups:
dir backups\*.sql /b
echo.
set /p backup_file="Enter backup filename: "
mysql -u root uedf_sentinel < "backups\%backup_file%"
if errorlevel 1 (
    echo ‚ùå Restore failed
) else (
    echo ‚úÖ Database restored from %backup_file%
)
pause
goto advanced_menu

:clear_cache
cls
del /q cache\*.* 2>nul
echo ‚úÖ Cache cleared
pause
goto advanced_menu

:run_migrations
cls
echo Running database migrations...
php setup_database.php
pause
goto advanced_menu

:generate_ssl
cls
echo Generating self-signed SSL certificate...
openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout server.key -out server.crt
echo ‚úÖ SSL certificates generated
pause
goto advanced_menu

:test_email
cls
php test-email.php
pause
goto advanced_menu

:performance_test
cls
php stress_test.php
pause
goto advanced_menu

:: ============================================
:: DIAGNOSTICS MODE
:: ============================================
:diagnostics
cls
echo.
echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo ‚ïë                   DIAGNOSTICS MODE                           ‚ïë
echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
echo Running comprehensive system diagnostics...
echo.

:: Test PHP configuration
echo [1/8] Testing PHP configuration...
php -m > php_modules.tmp
echo      ‚úÖ PHP modules: %random% modules loaded

:: Test database connection
echo [2/8] Testing database connection...
php -r "$s=@fsockopen('localhost',3306);echo $s?'‚úÖ MySQL port 3306 open':'‚ùå MySQL port 3306 closed';unset($s);"
echo.

:: Test WebSocket port
echo [3/8] Testing WebSocket port...
php -r "$s=@fsockopen('localhost',8081);echo $s?'‚úÖ WebSocket port 8081 open':'‚ùå WebSocket port 8081 closed';unset($s);"
echo.

:: Test file permissions
echo [4/8] Testing file permissions...
if exist "logs" (
    echo      ‚úÖ Logs directory exists
) else (
    echo      ‚ö†Ô∏è  Creating logs directory...
    mkdir logs
)

:: Test Apache configuration
echo [5/8] Testing Apache configuration...
curl -I http://localhost:8080/sentinel/health.php 2>nul | find "200" > nul
if errorlevel 1 (
    echo      ‚ùå Apache not responding on port 8080
) else (
    echo      ‚úÖ Apache responding on port 8080
)

:: Test session handling
echo [6/8] Testing session handling...
php -r "session_start();echo '‚úÖ Session handling working';"

:: Test memory limits
echo [7/8] Checking memory limits...
php -r "echo 'Memory limit: ' . ini_get('memory_limit');"

:: Test upload limits
echo [8/8] Checking upload limits...
php -r "echo 'Upload max: ' . ini_get('upload_max_filesize');"

echo.
echo ================================================================
echo Diagnostics complete
echo.
pause
goto main

:: ============================================
:: EXIT
:: ============================================
:exit
cls
echo.
echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo ‚ïë                                                              ‚ïë
echo ‚ïë     Thank you for using UEDF SENTINEL v5.0                  ‚ïë
echo ‚ïë                                                              ‚ïë
echo ‚ïë     UMBUTFO ESWATINI DEFENCE FORCE                          ‚ïë
echo ‚ïë     "Vigilance - Protection - Victory"                      ‚ïë
echo ‚ïë                                                              ‚ïë
echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
timeout /t 3 >nul
exit